\documentclass[12pt,a4paper]{report}

\usepackage[cp1251]{inputenc}
\usepackage[russian]{babel}
\usepackage{a4,cite,amsmath,amssymb,amsthm}
\usepackage[T2A]{fontenc}
\usepackage{amstext}
\usepackage{latexsym}
\usepackage{euscript}
\usepackage{mathrsfs}
\usepackage{graphicx}
\usepackage{geometry}
\geometry{left=3cm}
\geometry{right=2cm}
\geometry{top=1.5cm}
\geometry{bottom=2.0cm}

\newtheorem*{theorem}{Теорема}
\newtheorem*{definition}{Определение}
\newtheorem*{lemma}{Лемма}

\begin{document}
\input{title-list.tex}% это титульный лист

\thispagestyle{empty}
\newpage

\thispagestyle{empty}

\section*{\centering{РЕФЕРАТ}}

\medskip

Березин А.А. ЗАДАЧА ПОСТРОЕНИЯ ГРАФИКА ГОРЯЧЕЙ ПРОКАТКИ, СБАЛАНСИРОВАННОГО ПО ВИДАМ ПРОДУКЦИИ. АЛГОРИТМЫ ПОСТРОЕНИЯ ГРАФИКА,

выпускная квалификационная работа на степень магистра наук: стр. ?, рис. ?, табл. ?, форм. ?, библ. ? назв.

\medskip

Ключевые слова: ГОРЯЧАЯ ПРОКАТКА, ОРИЕНТИРОВАННЫЕ ГРАФЫ, ВЕЩЕСТВЕННО-ЦЕЛОЧИСЛЕННОЕ ПРОГРАММИРОВАНИЕ

Объект исследования --- раскрашенные вершинно-взвешенные ориентированные графы специального вида, возникающие при планировании расписания для стана горячей прокатки.

Цель работы --- поиск в этих графах простых цепей, в которых суммарный вес узлов каждого цвета максимально близок к заданному значению.

Решение задачи поиска «сбалансированной» простой цепи сводится к решению серии задач вещественно-целочисленного программирования. Этот подход основан на результатах Леоновой С.И. по изучению структуры рассматриваемых графов \cite{svLeon_2016} и позволяет существенно снизить размерность получаемых задач вещественно-целочисленного программирования по сравнению с прямым использовании классических техник для их построения (например, \cite{Dantzig}). Полученные результаты применяются для решения более общих задач в области планирования металлургического производства.

\newpage

\setcounter{page}{2}

\tableofcontents

\newpage

\chapter*{Введение}
\addcontentsline{toc}{chapter}{Введение}
\label{introduction}
В настоящей работе исследуется задача оперативного планирования работы непрерывных полосовых станов горячей прокатки стали.

Горячая прокатка стали это процесс производства полос различной ширины и толщины из стальных заготовок, имеющих форму параллелепипедов. В металлургии такие заготовки называются слябами. Обычно ширина сляба заметно больше его толщины. Во время прокатки слябы один за другим проходят через непрерывный полосовой стан горячей прокатки, который преобразует их в полосы давлением в клетях. Клеть это основной рабочий механизм стана, состоящий рабочих валков, которые непосредственно воздействуют на заготовку, и опорных валков, которые располагаются над и под рабочими валками и служат для увеличения жесткости валковой системы. При этом ширина прокатанной полосы близка к ширине сляба, из которого она получена, а ее толщина на порядок или два меньше толщины сляба. Длина полосы может исчисляться в сотнях метров, длина сляба от нескольких метров до десяти-двенадцати метров.

При планировании работы стана оперируют не отдельными слябами, а их группами, так называемыми партиями прокатки. Партия прокатки представляет собой набор слябов, имеющих одинаковые геометрические размеры и одинаковый химический состав (с погрешностью, которой можно пренебречь). Для всех слябов в партии заданы одни и те же значения ширины и толщины, которые должны получить прокатанные из них полосы на выходе из стана. Таким образом, слябы каждой партии считаются идентичными, как и прокатываемые из них полосы. После того, как все слябы прокатаны в полосы, полученную совокупность также называют партией. Далее по контексту будет понятно, о каком состоянии партии идет речь. Во время прокатки слябы каждой партии следуют друг за другом непрерывно, не перемежаясь слябами из других партий, то есть партии прокатываются целиком и не дробятся на части.

Можно выделить два рабочих цикла стана. Первый, или большой цикл, заключен между двумя последовательными заменами опорных валков стана. Замена делается обычно один раз в несколько дней. Второй, или малый цикл, заключен между двумя последовательными заменами рабочих валков стана. Длительность цикла работы стана между двумя последовательными заменами рабочих валков составляет несколько часов.
Задача оперативного планирования работы стана состоит в формировании последовательности партий, которая будет прокатана на стане в период между двумя очередными заменами рабочих валков.
Такую последовательность партий называют графиком прокатки. Обычно в сутки требуется сформировать примерно четыре-шесть последовательных графиков прокатки.

В данной работе рассматривается ситуация, когда для каждой партии прокатки известно, для какого вида продукции она изготавливается, пойдут ли полосы партии сразу на отгрузку потребителю (после порезки) или будут направлены для дальнейшей обработки в другие цеха предприятия (например, травление, холодная прокатка и прочее). В зависимости от того, куда будет направлена партия после прокатки, ее относят к тому или другому виду продукции. Обычно оперируют десятью-пятнадцатью видами продукции.

Для того, чтобы обеспечить выполнение заказов, отгрузку продукции непосредственному потребителю и равномерную загрузку сырьем для работы других цехов предприятия, при формировании каждого следующего графика прокатки создается так называемое задание на прокатку. Задание на прокатку включает в себя общее количество металла, которое должен содержать формируемый график, а также количество металла по отдельным видам продукции. Целевые значения количества металла рассчитываются на момент планирования исходя из текущего состояния складов полуфабрикатов, количества готовой продукции, состава уже сформированных графиков прокатки, информации о трудоемкости логистических операций, производительности последующих в технологических цепочках цехов и агрегатов и так далее. Целевые значения количества металла в графике прокатки даются вместе с диапазонами допустимого отклонения от них, составляющими несколько процентов. Обычно вместо целевого значения количества металла по какому-либо виду продукции рассматривают сразу диапазон допустимых значений. Например, задание на прокатку может выглядеть так: из данного множества партий, включающего в себя партии вида <<a>>, <<b>> и <<c>>, требуется сформировать график прокатки, в котором суммарная длина прокатанных полос находится в диапазоне от 100 до 120 километров, суммарная длина полос партий вида <<a>> находится в диапазоне от 35 до 40 километров, суммарная длина полос партий вида <<b>> находится в диапазоне от 50 до 60 километров, а на суммарную длину полос вида <<c>> ограничение не накладывается.

Существует несколько критериев оценки качества графика прокатки. В данной работе основным критерием оценки качества графика прокатки выбрана степень соответствия суммарной длины полос графика и суммарной длины полос партий по каждому виду продукции заданным диапазонам допустимых значений. Если в графике прокатки суммарная длина полос партий по каждому виду продукции находится в заданном диапазоне, то такой график прокатки будем называть сбалансированным по видам продукции, или просто сбалансированным.

Задача формирования сбалансированного графика прокатки является весьма нетривиальной, поскольку существует целый ряд технологических ограничений, которым график прокатки должен удовлетворять.

Основными технологическими ограничениями являются ограничения на допустимый порядок следования партий друг за другом в графике прокатки.
В данной работе рассмотрены два из них, оба ограничения возникают из-за конструктивных особенностей стана горячей прокатки.
Первое ограничение состоит в том, что требуется формировать только такие графики прокатки, в которых ширина каждой следующей партии не возрастает. Оно обусловлено тем, что во время прокатки рабочие валки стана сильно изнашиваются, и на их поверхности появляется углубление по ширине прокатываемых заготовок. Поэтому если после заготовки с меньшей шириной пропустить через стан заготовку с большей шириной, то на поверхности последней могут появиться дефекты.
Также к первому ограничению относится требование, чтобы ширина каждой следующей партии в графике прокатки не уменьшалась больше, чем на заданную величину.
Второе ограничение на порядок следования партий друг за другом в графике прокатки заключается в том, что толщина каждой следующей партии не должна слишком сильно отличаться от толщины предыдущей. Это ограничение обусловлено тем, что во время прокатки необходимо подстраивать расстояние между верхними и нижними валками стана в соответствии с толщиной прокатываемой заготовки, при этом хочется минимизировать эти перестроения валков.

Кроме того в данной работе рассматривается еще один класс ограничений связанных со временем готовности партий к прокатке.

Поскольку обычно производственный цикл металлургического предприятия является непрерывным, то при формировании каждого следующего графика прокатки помимо текущего множества готовых к прокатке партий, также известно, какие еще партии будут произведены и станут готовы  к прокате в ближайшем будущем. Эти еще не произведенные партии участвуют в формировании графиков прокатки наравне с уже готовыми партиями. Рассматривается ситуация, когда для каждой партии известен момент времени, начиная с которого партия готова к прокатке, а также известно какой промежуток времени требуется на прокатку данной партии. Эта информация позволяет формировать графики, в которых некоторые партии еще не готовы к прокатке на момент начала прокатки графика. При этом накладывается требование, чтобы к моменту, когда очередь дойдет до каждой следующей партии, она была готова к прокатке.

В настоящей работе будет предложена математическая модель для задачи формирования сбалансированного графика прокатки и алгоритм ее решения.

\newpage

\chapter{Формализация задачи построения сбалансированного графика прокатки}
\label{formulation}

Обозначим все множество партий через $P$. Рассматривается конечный набор партий, то есть $|P| \in \mathbb N$.

\section{Ограничения на порядок следования партий}
Для начала формализуем ограничения на порядок следования партий друг за другом в графике прокатки.

Введем следующие обозначения.

\begin{itemize}
\item $w: P \rightarrow \mathbb{R}^+$ — ширина полос, получаемых из слябов партии, значение $w$ на элементе $p \in P$ будем обозначать $w_p$.

    Множество всех ширин партий обозначим через $W = \{w_p | p \in P \}$.

\item $\delta \in \mathbb{R}^+$ --- максимальная величина допустимой разности значений ширины полос между любыми двумя соседними партиями.

\item $t: P \rightarrow \mathbb{R}^+$ — толщина полос, получаемых из слябов партии, значение $t$ на элементе $p \in P$ будем обозначать $t_p$.

\item $r: \mathbb{R}^+ \rightarrow \mathbb{R}^+$ --- функция, определяющая максимальную величину, на которую может отличаться значение толщины партии от значения толщины соседней партии в графике прокатки. Данная функция должна быть монотонно неубывающей, то есть
    $\forall t_1, t_2 \in {\mathbb R}^+ \; t_1 \le t_2 \Rightarrow r(t_1) \le r(t_2)$.
\end{itemize}

Ограничение на предшествование партий определим следующим образом: партия $q$ может непосредственно следовать за партией $p$ в графике прокатки в том и только в том случае, когда выполнено
\begin{enumerate}
\item ограничение <<для перехода по толщине>>:
 $|t_p - t_q| \le \min\{r(t_p), r(t_q)\}$;
\item ограничение <<для перехода по ширине>>:
$0 \le w_p - w_q \le \delta$.
\end{enumerate}

Определенное таким образом ограничение представляет собой формализацию базовых условий предшествования партий, используемых на некоторых отечественных предприятиях. В частности, на магнитагорском металлургическом комбинате используется значения $\delta = 250 \; mm$. Далее  представлен пример функции $r$.
 \begin{equation*} r(t) = \begin{cases}
                0.8, & \text{если $t \in [1.29, 2]$;}\\
                1.5, & \text{если $t \in (2, 3]$;}\\
                2, & \text{если $t \in (3, 16]$};\\
                4, & \text{если $t \in (16, 20]$};\\
                \text{не определена}, & \text{если $t \in [0, 1.29) \cup (20, +\infty)$}.
         \end{cases} \end{equation*}

\textbf{Пример.} Пусть имеются две партии $p$ и $q$.

Если $w_p$ = $w_q$, это означает, что для этих партий тривиально выполнено <<ограничение для перехода по ширине>>.

Если $t_p = 2, t_q = 3$, то для этих партий <<ограничение для перехода по толщине>> не выполнено.

Если $t_p = 2.5, t_q = 2$, то для этих партий <<ограничение для перехода по толщине>> выполнено.

\section{Сбалансированность графика прокатки}
Обозначим множество видов продукции партий через $F$. Различных видов продукции конченое число, то есть $|F| \in \mathbb{N}$.
Введем следующие обозначения.

\begin{itemize}
\item $f: P \rightarrow F$ — функция, сопоставляющая каждой партии соответствующий ей вид продукции.

\item $l: P \rightarrow \mathbb{R}^+$ — весовая функция, характеризующая полезность партии,\\ значение $l$ на элементе $p \in P$ будем обозначать $l(p)$.

    В зависимости от конкретной задачи, в качестве полезности партии могут выступать разные характеристики. Этими характеристиками могут быть длина (в километрах), вес (в тоннах) партии, а также более сложные величины, учитывающие спрос, время изготовления, стоимость продукции и так далее.

    В данной работе $l(p)$ — суммарная длина полос партии $p$. Поскольку функция $l$ названа <<весовой>>, то далее будем говорить про вес партии, имея ввиду значение $l(p)$.


\item $\mu : F \rightarrow \mathbb{R^+}$ — функция, задающая целевые значения суммарного веса партий каждого вида продукции в графике прокатки.

\item $\Delta : F \rightarrow \mathbb{R^+}$ — функция, задающая абсолютную величину допустимого отклонения от целевого значения суммарного веса партий по каждому виду продукции в графике прокатки.

\item $L_{min}, L_{max} \in \mathbb{R^+}$ — числа, задающие диапазон допустимых значений суммарного веса партий в графике прокатки.



\end{itemize}

\section{Граф предшествования партий}
В настоящей работе предложен подход, при котором ограничения на порядок следования партий формализуются при помощи графа предшествования партий.
Пусть $G$ раскрашенный вершинно-взвешенный ориентированный граф со множеством узлов $P$ и с множеством дуг $E \subseteq P\times P$ таким, что $pq \in E$ в том и только в том случае, когда партии $p$ и $q$ различны, и $q$ может непосредственно следовать за $p$ в графике прокатки.
Весом каждого узла в $G$ положим вес соответствующей партии $l(p)$, цвет каждого узла в $G$ соответствует виду продукции, к которому относится соответствующая партия.

В прошлой работе (\cite{berezinant}) был придуман удобный способ укладки графа предшествования партий на координатной плоскости, при котором абсциссой каждого узла является значение функции $t$, а ординатой значение функции $w$. На рисунке \ref{precedence_graph} изображен фрагмент графа предшествования партий.
\begin{figure}[h!]
\centering
\includegraphics[width=300px]{img/colored_graph.png}
\caption{Граф предшествования партий}
\label{precedence_graph}
\end{figure}

На этом рисунке можно наглядно увидеть ограничение <<для перехода по ширине>>. Оно заключается в том, что все дуги в графе предшествования партий направлены либо сверху внизу, либо горизонтально, и в графе отсутствуют дуги идущие снизу вверх. Ограничение <<для перехода по толщине>> так же проиллюстрировано тем, что между собой соединены лишь те узлы, которые имеют достаточно близкие абсциссы.

Любой дуге в графе $G$ соответствует упорядоченная пара партий, которая является технологически пригодной для прокатки в таком порядке. Поэтому множеству всех простых цепей в $G$ соответствует множество всех допустимых графиков прокатки для рассматриваемого множества партий $P$. Множество всех простых цепей в $G$ обозначим через $\mathbb{B}(G)$.

Далее будем отождествлять партии прокатки и узлы графа предшествования партий.


\section{Задача существования сбалансированной простой цепи}

Пусть $P(M)$ — множество узлов произвольного подграфа $М$ графа $G$.

Для простой цепи $H \in \mathbb{B}(G)$ через $l(H)$ обозначим её вес.

$$l(H) \triangleq \displaystyle\sum_{p \in P(H)} l(p)$$

Пронумеруем виды продукции, пусть $F = \{f_1, f_2, \ldots, f_s\}$.

Сформулируем задачу поиска допустимого решения — найти в $\mathbb{B}(G)$ такую \\ цепь $H$, что выполнены ограничения:

\begin{equation}  L_{min} \le \displaystyle\sum_{p \in P(H)} l(p) \le L_{max} \end{equation}

\begin{equation}
\forall k \in \overline{1,s}\;\;\;\; \mu_k - \Delta_k \le \sum_{p \in P(H), f(p) = f_k} l(p) \le \mu_k + \Delta_k
\end{equation}

\section{Актуальность задачи существования сбалансированной простой цепи}

В предыдущих работах (\cite{svLeon_2014, berezinant}) приводится обзор схожих по тематике работ и поясняется преимущество рассмотрения задачи построения графика прокатки именно как задачи поиска простой цепи в графе предшествования партий.

В данной работе, в отличие от предыдущих, выбран другой критерий оценки графика прокатки — сбалансированность. Существует несколько способов того, как можно формализовать практическую задачу построения графика прокатки сбалансированного по видам продукции. По существу это оптимизационная задача, в которой требуется приблизить распределение суммарного веса партий по каждому виду продукции максимально близко к целевым значениям.

Можно поставить, например, такую задачу с одним критерием оптимизации: найти в $\mathbb{B}(G)$ простую цепь $H$, где

\begin{equation*} \displaystyle\sum_{k = 1}^s\bigg{|}\mu(f_k) - \frac{\displaystyle\sum_{f(p_i) = f_k, p_i \in P(H)}l(p_i)}{ \displaystyle\sum_{p_i \in P(H)}l(p_i)}\bigg{|}
\rightarrow \min, p_i \in P(H) \end{equation*}

Такая задача имеет недостатком то, что в ней учитывается только <<общая>> сбалансированность решения. При этом нет гарантии, что в решении не будет <<перекосов>> и сильных отклонений по отдельным видам продукции, что является нежелательным с практической точки зрения.
Можно рассматривать многокритериальную постановку оптимизационной задачи, однако такая постановка существенно сложнее в том числе и с вычислительной точки зрения. В данной работе выбрана именно задача существования сбалансированной простой цепи, поскольку она является хорошим инструментом для решения практической задачи, при этом постановка является достаточно простой, что позволяет решать ее за приемлемое с практической точки зрения время.
\section{Дополнительные обозначения}

Пусть $p$ — произвольный узел в $G$. Для дальнейшего изложения удобно ввести следующие обозначения.
\begin{itemize}
\item $In(p)$ --- множество узлов $q$ таких, что дуга $qp \in E$,
\\ $|In(p)|$ --- входящая валентность узла $p$.
\item $In^{+}(p) = \{q \in In(p) | w_q > w_p\}$.
\item $Out(p)$ --- множество узлов $q$ таких, что дуга $pq \in E$,
\\ $|Out(p)|$ --- исходящая валентность узла $p$.
\end{itemize}

\medskip

Также рассмотрим множество всевозможных ширин узлов $W = \{w_p| p \in P\}$.
Для $w \in W$ обозначим через $P_w = \{p \in P | w_p = w\}$ множество узлов, имеющих данное значение $w$.
 $G_w$ --- граф, индуцированный множеством $P_w$.


\newpage

\chapter{Метод решения и структура работы}
\label{method}

Инструментом для решения практической задачи построения сбалансированного графика прокатки является задача существования сбалансированной простой цепи в графе следования партий. В предыдущих работах (\cite{svLeon_2014, berezinant}) рассмотрена оптимизационная постановка задачи поиска простой цепи в графе предшествования партий, в которой критерием оптимальности выбран суммарный вес вошедших в простую цепь узлов. Эту задачу удалось решить, предложив конструктивный полиномиальный алгоритм построения простой цепи с временной сложностью $o(n^3)$, где $n$ — число узлов в графе предшествования партий. Для решения задачи построения сбалансированной простой цепи создание подобного полиномиального алгоритма оказалось гораздо более сложным, поскольку помимо <<маршрутных>> ограничений на порядок следования узлов в задаче присутствуют <<объемные>> ограничения на суммарный вес узлов по каждому виду продукции. По этой причине было решено прибегнуть к аппарату математического программирования, поскольку он позволяет единообразно рассматривать как <<маршрутные>>, так и <<объемные>> ограничения.
Этот подход ценен еще и по той причине, что позволяет расширять рассматриваемую постановку, добавляя другие ограничения, которые существуют в реальной практической задаче. <<Объемные>> ограничения не исчерпывают все виды ограничений, которые можно рассматривать при моделировании практической задачи. Существуют еще, например, <<временные>> ограничения, связанные со временем готовности партий к прокатке и длительностью прокатки каждой партии. Используемый в данной работе подход позволяет учесть их наравне с остальными ограничениями, тогда как конструктивный полиномиальный алгоритм скорее всего стал бы непригоден для решения новой задачи.

Итак, в данной работе решение задачи существования <<сбалансированной>> простой цепи сводится к решению серии задач вещественно-целочисленного линейного программирования. Формализация <<маршрутных>> ограничений на порядок следования узлов в искомой простой цепи базируется на исследовании структуры графа предшествования партий (\cite{svLeon_2014, svLeon_2016}). Благодаря этому удается существенно снизить размерность получаемых задач линейного программирования по сравнению с прямым использовании классических техник для построения маршрутных задач (например, \cite{Dantzig}).

\section{Локальные задачи существования сбалансированной простой цепи}
Решение задачи существования сбалансированной простой цепи начнем с рассмотрения некоторых приближенных и упрощенных вариантов, затем рассмотрим исходную задачу. Рассматриваемые приближенные варианты задачи ценны, поскольку для их решения требуется существенно меньше времени, в некоторых ситуациях это может быть полезно. Кроме того, начиная изложение с приближенных задач, можно на более простых примерах продемонстрировать идеи, которые используются и для решения исходной задачи.

Для ориентированного графа предшествования партий $G$ рассмотрим его подграфы $G_w$, где  $w \in W$. Для каждого фиксированного $w \in W$ подграф $G_w$ порожден узлами $p$ исходного графа $G$, имеющих значение $w_p = w$.

Для любых двух принадлежащих $G_w$ узлов $p$ и $q$ ограничение <<для перехода по ширине>> тривиально выполняется, поэтому наличие дуги $pq$ в графе следования партий определяется лишь ограничением <<для перехода по толщине>>. Поскольку это ограничение является симметричным, то из существования дуги $pq$ следует существование дуги $qp$, поэтому подграф $G_w$ можно рассматривать как обыкновенный.

Итак, граф $G$ состоит из некоторого количества обыкновенных подграфов. Если узлы графа $G$ расположить на плоскости в соответствии со значением $w$ и $t$ (см. раздел 1.3 Граф предшествования партий), то каждый обыкновенный подграф $G_w$ будут состоять из узлов, имеющих одинаковую ординату $w$. При этом в соответствии с ограничением <<для перехода по ширине>> дуги между узлами различных подграфов могут идти только сверху вниз, и не могут идти снизу вверх. Поэтому любая достаточно длинная простая цепь в графе $G$ будет проходить через узлы подграфов $G_w$ сверху вниз (рисунок \ref{long_path}).

\begin{figure}[h!]
\centering
\includegraphics[width=300px]{img/g_w.png}
\caption{Структура достаточно длинной простой цепи в $G$}
\label{long_path}
\end{figure}

Решение задачи существования сбалансированной простой цепи в $G$ проходит через какую-то последовательность подграфов $G_{w_i}$.  Идея, на которой основано создание приближенных задач, заключается в том, что можно заранее выбрать и зафиксировать некоторую последовательность подграфов, и потребовать, чтобы искомая простая цепь в обязательном порядке проходила через выбранные подграфы. Это позволяет решать задачу существенно меньшей размерности, чем исходная задача существования, поскольку фиксированная последовательность подграфов, через которые должна пройти искомая простая цепь позволяет исключить многие <<маршрутные>> ограничения на порядок следования узлов. Задачу существования сбалансированной простой цепи с выбранной последовательностью подграфов назовем локальной задачей существования. Подробное описание локальной задачи существования будет изложено в следующем разделе.

Открытый вопрос, который сопутствует локальной задаче существования это то, каким образом можно эффективно выбирать последовательность подграфов. Далее предложено некоторое эвристическое соображение, используемое в этой работе.

Разработанный в прошлых работах (\cite{svLeon_2014, berezinant}) алгоритм построения простой цепи максимального веса в графе $G$ перебирает подграфы $G_w$ в порядке от большего значения $w$ к меньшему и строит максимальную по весу цепь $H_{max}$. Эта цепь отлично подходит в качестве некого начального приближения к решению задачи поиска сбалансированной простой цепи в $G$, поскольку обычно вес $H_{max}$ заведомо больше, чем требуется для сбалансированной цепи (а если он меньше, то значит, поставленная задача существования сбалансированной цепи несовместна), и кроме того в $H_{max}$ обычно заведомо больше узлов, относящихся к каждому виду продукции, чем того требует условие сбалансированности.

Далее дадим неформальное описание двух видов локальных задач существования.

\subsection{Задача с фиксированными входами и выходами}

Пусть $H$ — простая цепь в графе $G$. Зафиксируем последовательность подграфов $\{G_{w_i}\}$, через которые проходит простая цепь $H$ в порядке уменьшения значения $w_i$. Пронумеруем узлы цепи $H = (q_1, q_2, \ldots, q_n)$. Ввиду того, что в графе $G$ дуги, соединяющие различные подграфы $G_{w}$ направлены только от подграфа с большим значением $w$ к подграфу с меньшим значением $w$, узлы цепи $H$ идут через подграфы последовательности $\{G_{w_i}\}$ по порядку. Для каждого подграфа зафиксируем узел, являющийся первым узлом цепи $H$, принадлежащим данному подграфу, и назовем этот узел входом в подграф для цепи $H$. Зафиксируем также узел, являющийся последним узлом цепи $H$, принадлежащим данному подграфу, и назовем этот узел выходом из подграфа для цепи $H$. На рисунке \ref{enter_exit} подписаны входы и выходы в подграфы $G_w$ ($s_i$ и $e_i$ соответственно).

\begin{figure}[h!]
\centering
\includegraphics[width=300px]{img/first_model.png}
\caption{Входы и выходы подграфов $G_w$}
\label{enter_exit}
\end{figure}

Потребуем, чтобы входы и выходы каждого подграфа обязательно входили в простую цепь, являющуюся решением локальной задачи существования сбалансированной простой цепи. Это требования позволяет обеспечить связность частей цепи-решения, относящихся к различным подграфам $\{G_{w_i}\}$. Благодаря этому, при формализации локальной задачи существования в виде задачи математического программирования для обеспечения связности всей цепи в целом потребуется описать только <<маршрутные>> ограничения на порядок следования узлов в рамках отдельных подграфов.

Заметим, что для того, чтобы поставить локальную задачу существования сбалансированной простой цепи с фиксированными входами и выходами не обязательно иметь какую-либо простую цепь $H$. Можно выбирать последовательность подграфов $\{G_{w_i}\}$ и входы и выходы в них произвольным образом. Однако на практике решению этой задачи предшествует выбор цепи, являющейся начальным приближением.

Итак, локальная задача существования сбалансированной простой цепи с фиксированными входами и выходами формулируется следующим образом.

Пусть заданы
\begin{itemize}
    \item граф предшествования партий $G$,
    \item последовательность подграфов $\{G_{w_i}\}$,
    \item пары узлов $s_i, \; e_i$ — вход и выход для каждого подграфа,
    \item ограничения предшествования узлов в рамках отдельных подграфов,
    \item ограничения на суммарный вес узлов и на суммарный вес по каждому виду продукции.
\end{itemize}

Существует ли сбалансированная простая цепь при заданных ограничениях?

\subsection{Задача со свободными входами и выходами}

Зафиксируем последовательность подграфов $\{G_{w_i}\}$ в порядке уменьшения значения $w_i$. Цепь, являющаяся решением локальной задачи существования должна в обязательном порядке пройти через каждый из выбранных подграфов. При этом не будем фиксировать, какие именно узлы должны быть входами или выходами. Наличие фиксированной последовательности подграфов $\{G_{w_i}\}$ позволяет при формализации локальной задачи существования описать только <<маршрутные>> ограничения на порядок следования узлов в рамках отдельных подграфов и ограничения на порядок следования узлов между соседними подграфами в последовательности.


Пусть заданы

\begin{itemize}
   \item граф предшествования партий $G$,
    \item последовательность подграфов $\{G_{w_i}\}$,
    \item ограничения предшествования узлов в рамках отдельных подграфов,
    \item ограничения предшествования для узлов соседних подграфов,
    \item ограничения на суммарный вес и вес по каждому виду продукции.
\end{itemize}

Существует ли сбалансированная простая цепь при заданных ограничениях?


\section{Исходная задача существования сбалансированной простой цепи}
Для того, чтобы формализовать исходную задачу существования простой цепи во всем графе $G$, рассматривается последовательность всех подграфов $\{G_{w_i}\}$ в порядке уменьшения значения $w_i$, при этом не накладывается требование на то, чтобы цепь-решение в обязательном порядке проходила через каждый подграф последовательности, и не накладывается требование на то, какие именно узлы должны быть входами и выходами в подграфах. В этом случае при формализации задачи существования сбалансированной простой цепи в виде задачи математического программирования требуется описать как ограничения на порядок следования узлов в рамках отдельных подграфов, так и ограничения на порядок следования узлов между любыми подграфами, а не только соседними, как это было в локальной задачи существования сбалансированной простой цепи со свободными входами и выходами.

Пусть заданы

\begin{itemize}
    \item граф предшествования партий $G$,
    \item последовательность подграфов $\{G_{w_i}\}$,
    \item ограничения предшествования для связи всех подграфов,
    \item ограничения предшествования в рамках подграфов,
    \item ограничения на суммарный вес и вес по каждому виду продукции.
\end{itemize}

Существует ли сбалансированная простая цепь при заданных ограничениях?


\chapter{Формализация в виде задачи математического программирования}
\label{algorytm}


Пусть $G_{w_1}, G_{w_2}, \ldots, G_{w_m}$ — набор подграфов графа предшествования партий $G$ с множеством вершин $P$.

Пронумеруем вершины подграфов в порядке увеличения значения функции $t$. Пусть $p_{ij}$ — $j$-я вершина в $i$-м подграфе. Каждой вершине $p_{ij}$ поставим в соответствие булеву переменную $b_{ij}$ по следующему правилу.

 $$b_{ij} = \begin{cases}
                1, & \text{если $p_{ij}$ входит в цепь-решение};\\
                0, & \text{если $p_{ij}$ не входит в цепь-решение}.
         \end{cases}$$


Обозначим \begin{itemize}
\item $n_i = |P(G_{w_i})|$ — количество вершин в подграфе $G_{w_i}$,
\item $l_{ij} = l(p_{ij})$ — вес вершины $p_{ij}$,
\item $L_{min}, L_{max}$ — заданные минимальное и максимальное значения суммарного веса вершин в цепи-решении,
\item  $f_1, f_2, \ldots, f_s$ — набор видов продукции,
\item $\mu_i = \mu(f_i) = (\underline{\mu}_i, \overline{\mu}_i)$ — распределение видов продукции, заданное допустимым диапазоном значения суммарного веса вершин, имеющих $f_i$ вид продукции,
\item  $f_{ij} = f(p_{ij})$ — вид продукции, соответствующий вершине $p_{ij}$.
\end{itemize}

\subsection*{Ограничение на суммарный вес цепи}
\begin{equation}
L_{min} \le \displaystyle\sum_{i=1}^m \sum_{j=1}^{l_i} b_{ij}l_{ij}  \le L_{max}
\end{equation}

\subsection*{Ограничение на суммарный вес по видам продукции}
\begin{equation}
\forall k \in \overline{1,s}\;\;\;\; \underline{\mu}_k \le \sum_{f_{ij} = f_k} b_{ij}l_{ij} \le \overline{\mu}_k
\end{equation}

Указанные <<объемные>> ограничения являются базовыми, они присутствуют в любой постановке задачи существования сбалансированной простой цепи. Способы формализации <<маршрутных>> ограничений зависят от выбранной постановки. Прежде чем перейти к их описанию введем некоторые вспомогательные обозначения.

\subsection*{Дополнительные обозначения}


Пусть $p$, $q$ и $r$ — вершины подграфа $G_{w_i}$, то есть $p, q \in P_{w_i}$. Введем вспомогательные понятия.
\begin{itemize}
\item Вершина $p$ {\it левее} вершины $q$ (обозначим $p < q$), если $t_p < t_q$.
\item Вершина $p$ {\it не правее} вершины $q$ (обозначим $p \le q$), если $t_p \le t_q$.
\item Вершина $p$ {\it между} вершинами $r$ и $q$ если $r \le p$ и $p \le q$.
\item Вершина $p$ {\it правее} вершины $q$ (обозначим $p > q$), если $t_p > t_q$.
\item Вершина $p$ {\it не левее} вершины $q$ (обозначим $p \ge q$), если $t_p \ge t_q$.
\end{itemize}


Обозначим множество вершин подграфа $G_{w_i}$, находящихся правее вершины $p$ через $P_{i}^{>,p}$, зафиксируем множество индексов этих вершин и обозначим его через $J_{i}^{>,p}$.
\begin{itemize}
\item $P_{i}^{>,p} = \{q \in P_{w_i}\;|\; q > p\}$
\item $J_{i}^{>,p} = \{j \;|\; p_{ij} \in P_{i}^{>,p} \} $
\end{itemize}

Обозначим множество вершин подграфа $G_{w_i}$, находящихся правее вершины $p$ и смежных с ней через $\overset{o}{P}_{i}^{>,p}$, зафиксируем множество индексов этих вершин и обозначим его через $\overset{o}{J}_{i}^{>,p}$.

\begin{itemize}
\item $\overset{o}{P}_{i}^{>,p} = \{q \in P_{w_i}\;|\; q > p, \;  \; |t_q-t_p| \le min\{r(t_q),r(t_p)\}\}$
\item $\overset{o}{J}_{i}^{>,p} = \{j \;|\; p_{ij} \in \overset{o}{P}_{i}^{>,p} \} $
\end{itemize}

Аналогичные обозначения можно ввести для множества вершин подграфа $G_{w_i}$, находящихся левее вершины~$p$, не правее вершины~$p$ и не левее вершины~$p$.


Множество вершин подграфа $G_{w_i}$, находящихся между вершинами $p$ и $q$ (предположим, $p < q$) обозначим через $P_{i}^{p,\ge,q}$.
Соответственно множество индексов этих вершин $J_{i}^{p,\ge,q}$.


\section{Локальные задачи существования сбалансированной простой цепи}

\subsection{Задача с фиксированными входами и выходами}
\label{first_model}


\begin{itemize}
\item $G_{w_i}$ — подграф графа $G$, $s_i$, $e_i$ — заданная пара вершин, вход и выход для подграфа $G_{w_i}$.
\item Пусть $p_{ij_0} \in G_{w_i}$ — отличная от входа и выхода вершина, то есть $p_{ij_0} \not = s_i$ и $p_{ij_0} \not = e_i$.
\end{itemize}


Тогда eсли $t(s_i) < t_{ij_0} < t(e_i)$, то

\begin{equation}
b_{ij_0}\le \displaystyle \sum_{j'  \in \overrightarrow{J_p}} b_{ij'} \;\;\;\;
b_{ij_0}\le \displaystyle \sum_{j'  \in \overleftarrow{J_p}} b_{ij'}
\end{equation}

Если $t_{ij_0} < t(s_i)$, то

\begin{equation}
2b_{ij_0}\le \displaystyle \sum_{j'  \in \overrightarrow{J_p}} b_{ij'}
\end{equation}

Если $t(e_i) < t_{ij_0}$, то

\begin{equation}
2b_{ij_0}\le \displaystyle \sum_{j'  \in \overleftarrow{J_p}} b_{ij'}
\end{equation}


\subsection*{Локальная задача существования}
Локальная задача существования состоит в том, чтобы найти решение следующей системы уравнений и неравенств, либо установить, что его не существует.

$\begin{cases}
                L_{min} \le \displaystyle\sum_{i=1}^m \sum_{j=1}^{n_i} b_{ij}l_{ij}  \le L_{max};\\

                \medskip

                \forall i \in \overline{1, m}: \; b_i^s=1, \; b_i^e=1;\\

                \medskip

                \forall i \in \overline{1, m} \; \forall j_0 \in \overline{1, n_i}(p_{ij_0}\not\in\{s_i,e_i\}): \\

                \medskip

                \; \begin{cases}
                 \;  b_{ij_0}\le \displaystyle \sum_{j'  \in \overrightarrow{J_p}} b_{ij'}, \;\;\; b_{ij_0}\le \displaystyle \sum_{j'  \in \overleftarrow{J_p}} b_{ij'} , & \text{ eсли $t(s_i) < t_{ij_0} < t(e_i)$};\\

                 \smallskip

                  \;   2b_{ij_0}\le \displaystyle \sum_{j'  \in \overrightarrow{J_p}} b_{ij'}, & \text{если $t_{ij_0} < t(s_i)$};\\

                 \smallskip

                   \;   2b_{ij_0}\le \displaystyle \sum_{j'  \in \overleftarrow{J_p}} b_{ij'}, & \text{если $t(e_i) < t_{ij_0}$}.
                \end{cases}\\

                \medskip

                \forall k\in \overline{1,s}\;\;\;\; \underline{\mu_k} \le \displaystyle \sum_{f_{ij} = f_k} b_{ij}l_{ij} \le \overline{\mu_k}.
\end{cases}$

Вложенная подсистема неравенств эквивалентна тому, что для партий, вошедших в решение, на подмножестве партий (узлов), принадлежащих одному блоку вместе с входом и выходом возможно построить путь в $G$ с началом во входном узле и окончанием в выходном узле. Возможность собрать все партии в решении локальной задачи в один путь тогда вытекает из того, что входы и выходы в следующих друг за другом блоках выбраны согласованно.

Локальная задача существования может быть использована для получения решений и в более компактной схеме. В предыдущей работе \cite{berezinant} предложен алгоритм кубической временной трудоемкости, решающий задачу поиска пути максимального веса. По такому пути естественным образом строится набор блоков с входами и выходами. Используя эти данные в качестве начальных в локальной задаче существования иногда возможно построить решение. Вычислительные эксперименты, проведенные с использование системы IBM ILOG CPLEX, показали, что зачастую таким коротким путём возможно получить решение локальной задачи существования и, соответственно, решение исходной задачи. При этом решение получается за короткое время при числе партий порядка 100. При этом оптимальное решение локальной задачи зачастую строится за 1-2 секунды.



\begin{lemma} В подграфе $G_w$ существует простая $(s, e)$-цепь тогда и только тогда, когда существует решение системы 6. \end{lemma}

\section{Вторая модель}
\subsection*{Расширенная локальная задача существования}

Пусть заданы : \begin{itemize}
\item множество партий $P$,
\item фиксированная последовательность подграфов  $G_{w_1}, G_{w_2}, \ldots, G_{w_m}$,
\item ограничения(на вес, на предшествование, на виды продукции).
\end{itemize}

В рамках этой модели так же рассматривается фиксированный набор подграфов $G_{w_i}$ полученный на стадии генерации начального приближения.
Отличие от предыдущей задачи в том, что теперь не зафиксировано то, какие узлы могут быть входами и выходами, а значит требуется ввести ограничения, описывающие связность между соседними уровнями.

К модели добавляются следующие переменные:

Каждой партии $p_{ij}$ соответствуют

 $s_{ij} = \begin{cases}
                1, & \text{если $p_{ij}$ является входом в $i$ слой};\\
                0, & \text{если $p_{ij}$ не является входом в $i$ слой}.
         \end{cases}$

 $e_{ij} = \begin{cases}
                1, & \text{если $p_{ij}$ является выходом из $i$ слоя};\\
                0, & \text{если $p_{ij}$ не является выходом из $i$ слоя}.
         \end{cases}$

А так же к существующим добавляются ограничения:

В каждом слое должен быть ровно один вход и ровно один выход
$$\forall i \; \displaystyle \sum_{j} s_{ij} = 1$$
$$\forall i \; \displaystyle \sum_{j} e_{ij} = 1$$

Входы и выходы должны быть включены в график прокатки
$$\forall i \; \forall j \; b_{ij} \ge s_{ij}$$
$$\forall i \; \forall j \; b_{ij} \ge e_{ij}$$

Определим множество узлов в $k$-том слое, которые были бы связаны с узлом, имеющим ширину $t$\\
$$O_k(t) = \{ v \in B_k | \; |t(v)-t| \le min\{r(t(v)),r(t)\}\}$$
И множество индексов этих узлов\\
$$J_k(t) = \{ j | \; p_{kj} \in O_k(t)\}$$

Смысл следующего ограничения в том, что для каждого входа в слой, среди узлов-предков этого входа должен существовать узел, являющийся
выходом
$$\forall i = 2,...,m \; \forall j_0 \; s_{ij_0} \le \displaystyle \sum_{j \in O_{i-1}(t_{ij})} e_{i-1j}$$
Соответствующее ограничение для выходов
$$\forall i = 1,...,m-1 \; \forall j_0 \; e_{ij_0} \le \displaystyle \sum_{j \in O_{i+1}(t_{ij})} s_{i+1j}$$

Ограничения предшествования в рамках отдельных подграфов заменяются двумя новыми ограничениями:


\begin{itemize}
\item $$b_{ij0} \le \frac{1}{2} \displaystyle \sum_{j' \in \overrightarrow{J_{(b_{ij_0})}^{o}}} b_{ij'} + (1 - \frac{1}{2} \displaystyle \sum_{j \in \overrightarrow{J_{(b_{ij_0})}}} (s_{ij} + e_{ij}))$$

\item $$b_{ij0} \le \frac{1}{2} \displaystyle \sum_{j' \in \overleftarrow{J_{(b_{ij_0})}^{o}}} b_{ij'} + (1 - \frac{1}{2} \displaystyle \sum_{j \in \overleftarrow{J_{(b_{ij_0})}}} (s_{ij} + e_{ij}))$$
\end{itemize}
Где

$$\overrightarrow{Out}_{B_i}^{o}(p)=\{q \in B_i\;|\;t_q>t_p, \;  \; |t_q-t_p| \le min\{r(t_q),r(t_p)\}\}$$
$$\overrightarrow{J_{p}^{o}} = \{j | p_{ij}\in \overrightarrow{Out}_{B_i}^{o}(p_{ij_0}) \}$$

и соответственно

$$\overleftarrow{Out}_{B_i}^{o}(p)=\{q \in B_i\;|\;t_q<t_p, \;  \; |t_q-t_p| \le min\{r(t_q),r(t_p)\}\}$$
$$\overleftarrow{J_{p}^{o}} = \{j | p_{ij}\in \overleftarrow{Out}_{B_i}^{o}(p_{ij_0}) \}$$


\section{Третья модель}

Эта модель является развитием предыдущей задачи. В предыдущей задаче была задана фиксированная последовательность подграфов, в том смысле что для построения решения необходимо было, чтобы в него были включены узлы из каждого подграфа. Теперь же сформулируем ограничения для связности подграфов таким образом, чтобы избежать этой необходимости. Это позволит рассматривать в рамках третьей модели произвольные последовательности подграфов (а значит, мы сможем перейти от локальных задач существования к глобальной).

Для каждого подграфа $G_{w_i}$ поставим в соответствие переменную $$q_i = \begin{cases}
                1, & \text{если подграф $G_{w_i}$ включен в решение (хотя бы 1 узел из $G_{w_i}$)};\\
                0, & \text{иначе}.
         \end{cases}$$

Если подграф $G_{w_i}$ не включен, то ни один его узел не представлен в решении.
$$\forall i \; \forall j \; b_{ij} \le q_i$$

Если хотя бы один узел подграфа $G_{w_i}$ включен, то подграф включен в решение.
$$\forall i \; q_i \le \displaystyle \sum_{j} b_{ij} $$

Если есть вход и есть выход, то подграф включен в решение.
$$\forall i \; q_i = \displaystyle \sum_{j} e_{ij} = \displaystyle \sum_{j} s_{ij}$$

Входы и выходы включены в решение.
$$\forall i \; \forall j \; b_{ij} \ge s_{ij}$$
$$\forall i \; \forall j \; b_{ij} \ge e_{ij}$$

Если подграф включен в решение, то среди узлов-предков входа в этот уровень должны быть включенные в решение узлы.
$$s_{ij} \le \displaystyle \sum_{k < l < i} q_l + \displaystyle \sum_{z \in In_{B_{k}}(p_{ij})}  e_{kz} + (1 - q_k)$$

Аналогично для выходов.
$$e_{ij} \le \displaystyle \sum_{i < l < k} q_l + \displaystyle \sum_{z \in Out_{B_{k}}(p_{ij})}  s_{kz} + (1 - q_k)$$

Плюс ограничения на связность в рамках подграфов не меняются, они такие же как и в предыдущей модели.

\begin{itemize}
\item $$b_{ij0} \le \frac{1}{2} \displaystyle \sum_{j' \in \overrightarrow{J_{(b_{ij_0})}^{o}}} b_{ij'} + (1 - \frac{1}{2} \displaystyle \sum_{j \in \overrightarrow{J_{(b_{ij_0})}}} (s_{ij} + e_{ij}))$$

\item $$b_{ij0} \le \frac{1}{2} \displaystyle \sum_{j' \in \overleftarrow{J_{(b_{ij_0})}^{o}}} b_{ij'} + (1 - \frac{1}{2} \displaystyle \sum_{j \in \overleftarrow{J_{(b_{ij_0})}}} (s_{ij} + e_{ij}))$$
\end{itemize}


\newpage

\chapter{Программная реализация}
\label{program}
В работе использован язык программирования Java.

\section{Описание кода программы}
\subsection{Типы данных}

\subsection{Методы}

\section{Результаты экспериментов}
Данные для тестов берутся из корпоративной сети ОАО "ММК". Обычно в распоряжении имеются выборки порядка 200-300 партий.

Реальные данные таковы, что обычно при больших выборках от 75\% процентов узлов попадают в построенную цепь. Это хороший с практической точки зрения результат, т.к. на производстве такие большие графики прокатки избыточны и построенную цепь можно дополнительно редактировать, добиваясь выполнения остальных технических ограничений, не упоминаемых в этой работе.


Так же отметим, что программа работает достаточно быстро, что важно, потому что в реальной жизни требуется многократный запуск алгоритма.
Видно, что скорость работы программы довольно сильно зависит от структуры конкретных начальных данных. Имеет значение соотношение между количеством подграфов в исходном графе и количеством входящих в них узлов. Например в случае, когда исходный граф состоит из малого числа подграфов, то время работы уменьшается за счет сокращения перебора дуг между подграфами(выборка 6).


(Тесты проводились на персональном компьютере).
\newpage


\section{Инструкция пользователю}
\label{instrution}

\newpage


\chapter*{Заключение}
\addcontentsline{toc}{chapter}{Заключение}
\label{conclusion}
Автоматическое планирование металлургического производства является сложной задачей, которая до сих пор не реализована полностью ни на одном предприятии в мире. Сопутствующие ей математические постановки зачастую являются труднорешаемыми. За счет исследования технологических ограничений на конкретном предприятии удалось сформулировать математическую задачу планирования графика прокатки. Удалось разработать полиномиальный алгоритм её решения. Результат уже частично внедрён и продолжается внедрятся на ОАО "ММК". В реальной жизни существуют более общие и сложные постановки задачи планирования графиков прокатки, решение которых основывается на описанных в настоящей работе алгоритмах.
\newpage

\small

\addcontentsline{toc}{chapter}{Список литературы}

\begin{thebibliography}{50}
\bibitem{svLeon_2016} {\it Леонова С.И.} {\rm Задача о формировании графика работы стана горячей прокатки, сбалансированного
по составу продукции, 2016}
\bibitem{svLeon_2014} {\it Леонова С.И.} {\rm Разработка и исследование алгоритмов построениея экстремальных цепей в вершинно-взвешенных ориентированных графах. Частный алгоритм, 2014}
\bibitem{berezinant} {\it Березин А.А.} {\rm Разработка и исследование алгоритмов построениея экстремальных цепей в вершинно-взвешенных ориентированных графах. Общий алгоритм, 2014}
\bibitem{Dantzig} {\it Dantzig G.B., Fulkerson D.R. , Johnson S.} {\rm On a linear programming combinatorial approach to the traveling salesman problem, Operations Research, 7 (1959), pp. 58–66}%
\bibitem{BeVaLe_Bals} {\it Balas E., Clarence H. M.}{\rm  Combinatorial optimization in steel rolling.
Workshop on Combinatorial Optimization in Science and Technology, April, 1991.}%
\bibitem{BeVaLe_ReviewStellProduction} {\it Lixin Tang, Jiyin Liu, Aiying Rong, Zihou Yang.} {\rm A review of planning and scheduling systems and methods for integrated steel production. European Journal of Operational Research. Volume 133, Issue 1, 16 August 2001, PP. 1–20.}%
\bibitem{BeVaLe_Liu} {\it Shixin Liu.} {\rm Model and Algorithm for Hot Rolling Batch Planning in Steel Plants. International Journal of Information and Management Sciences. 21 (2010), PP. 247-263.}%


\end{thebibliography}

\newpage

\chapter*{Приложение}
\addcontentsline{toc}{chapter}{Приложение}
\label{app}


\section*{Пример исходного кода}

\end{document} 