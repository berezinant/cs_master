\documentclass[12pt,a4paper]{report}

\usepackage[cp1251]{inputenc}
\usepackage[russian]{babel}
\usepackage{a4,cite,amsmath,amssymb,amsthm}
\usepackage[T2A]{fontenc}
\usepackage{amstext}
\usepackage{latexsym}
\usepackage{euscript}
\usepackage{mathrsfs}
\usepackage{graphicx}
\usepackage{geometry}
\geometry{left=3cm}
\geometry{right=2cm}
\geometry{top=1.5cm}
\geometry{bottom=2.0cm}

\newtheorem*{theorem}{Теорема}
\newtheorem*{definition}{Определение}
\newtheorem*{lemma}{Лемма}

\begin{document}
\input{title-list.tex}% это титульный лист
\newpage

Эта страница появилась здесь, потому что я не умею нормально нумеровать страницы в TeX.

\newpage

\section*{\centering{РЕФЕРАТ}}

\medskip

Березин А.А. ЗАДАЧА ПОСТРОЕНИЯ ГРАФИКА ГОРЯЧЕЙ ПРОКАТКИ, СБАЛАНСИРОВАННОГО ПО ВИДАМ ПРОДУКЦИИ. АЛГОРИТМЫ ПОСТРОЕНИЯ ГРАФИКА,

выпускная квалификационная работа на степень магистра наук: стр. ?, рис. ?, табл. ?, форм. ?, библ. ? назв.

\medskip

Ключевые слова: ГОРЯЧАЯ ПРОКАТКА, ОРИЕНТИРОВАННЫЕ ГРАФЫ, ВЕЩЕСТВЕННО-ЦЕЛОЧИСЛЕННОЕ ПРОГРАММИРОВАНИЕ

Объект исследования --- раскрашенные вершинно-взвешенные ориентированные графы специального вида, возникающие при планировании расписания для стана горячей прокатки.

Цель работы --- поиск в этих графах простых цепей, в которых суммарный вес узлов каждого цвета максимально близок к заданному значению.

Решение задачи поиска «сбалансированной» простой цепи сводится к решению серии задач вещественно-целочисленного программирования. Этот подход основан на результатах Леоновой С.И. по изучению структуры рассматриваемых графов \cite{svLeon_2016} и позволяет существенно снизить размерность получаемых задач вещественно-целочисленного программирования по сравнению с прямым использовании классических техник для их построения (например, \cite{Dantzig}). Полученные результаты применяются для решения более общих задач в области планирования металлургического производства.

\newpage

\tableofcontents

\newpage

\chapter*{Введение}
\addcontentsline{toc}{chapter}{Введение}
\label{introduction}
В настоящей работе исследуется задача оперативного планирования работы непрерывных полосовых станов горячей прокатки стали.

Горячая прокатка стали это процесс производства полос различной ширины и толщины из стальных заготовок, имеющих форму параллелепипедов. В металлургии такие заготовки называются слябами. Обычно ширина сляба заметно больше его толщины. Во время прокатки слябы один за другим проходят через непрерывный полосовой стан горячей прокатки, который преобразует их в полосы давлением в клетях. Клеть это основной рабочий механизм стана, состоящий рабочих валков, которые непосредственно воздействуют на заготовку, и опорных валков, которые располагаются над и под рабочими валками и служат для увеличения жесткости валковой системы. При этом ширина прокатанной полосы близка к ширине сляба, из которого она получена, а ее толщина на порядок или два меньше толщины сляба. Длина полосы может исчисляться в сотнях метров, длина сляба от нескольких метров до десяти-двенадцати метров.

При планировании работы стана оперируют не отдельными слябами, а их группами, так называемыми партиями прокатки. Партия прокатки представляет собой набор слябов, имеющих одинаковые геометрические размеры и одинаковый химический состав (с погрешностью, которой можно пренебречь). Для всех слябов в партии заданы одни и те же значения ширины и толщины, которые должны получить прокатанные из них полосы на выходе из стана. Таким образом, слябы каждой партии считаются идентичными, как и прокатываемые из них полосы. После того, как все слябы прокатаны в полосы, полученную совокупность также называют партией. Далее по контексту будет понятно, о каком состоянии партии идет речь. Во время прокатки слябы каждой партии следуют друг за другом непрерывно, не перемежаясь слябами из других партий, то есть партии прокатываются целиком и не дробятся на части.

Можно выделить два рабочих цикла стана. Первый, или большой цикл, заключен между двумя последовательными заменами опорных валков стана. Замена делается обычно один раз в несколько дней. Второй, или малый цикл, заключен между двумя последовательными заменами рабочих валков стана. Длительность цикла работы стана между двумя последовательными заменами рабочих валков составляет несколько часов.
Задача оперативного планирования работы стана состоит в формировании последовательности партий, которая будет прокатана на стане в период между двумя очередными заменами рабочих валков.
Такую последовательность партий называют графиком прокатки. Обычно в сутки требуется сформировать примерно четыре-шесть последовательных графиков прокатки.

В данной работе рассматривается ситуация, когда для каждой партии прокатки известно, для какого вида продукции она изготавливается, пойдут ли полосы партии сразу на отгрузку потребителю (после порезки) или будут направлены для дальнейшей обработки в другие цеха предприятия (например, травление, холодная прокатка и прочее). В зависимости от того, куда будет направлена партия после прокатки, ее относят к тому или другому виду продукции. Обычно оперируют десятью-пятнадцатью видами продукции.

Для того, чтобы обеспечить выполнение заказов, отгрузку продукции непосредственному потребителю и равномерную загрузку сырьем для работы других цехов предприятия, при формировании каждого следующего графика прокатки создается так называемое задание на прокатку. Задание на прокатку включает в себя общее количество металла, которое должен содержать формируемый график, а также количество металла по отдельным видам продукции. Целевые значения количества металла рассчитываются на момент планирования исходя из текущего состояния складов полуфабрикатов, количества готовой продукции, состава уже сформированных графиков прокатки, информации о трудоемкости логистических операций, производительности последующих в технологических цепочках цехов и агрегатов и так далее. Целевые значения количества металла в графике прокатки даются вместе с диапазонами допустимого отклонения от них, составляющими несколько процентов. Обычно вместо целевого значения количества металла по какому-либо виду продукции рассматривают сразу диапазон допустимых значений. Например, задание на прокатку может выглядеть так: из данного множества партий, включающего в себя партии вида <<a>>, <<b>> и <<c>>, требуется сформировать график прокатки, в котором суммарная длина прокатанных полос находится в диапазоне от 100 до 120 километров, суммарная длина полос партий вида <<a>> находится в диапазоне от 35 до 40 километров, суммарная длина полос партий вида <<b>> находится в диапазоне от 50 до 60 километров, а на суммарную длину полос вида <<c>> ограничение не накладывается.

Существует несколько критериев оценки качества графика прокатки. В данной работе основным критерием оценки качества графика прокатки выбрана степень соответствия суммарной длины полос графика и суммарной длины полос партий по каждому виду продукции заданным диапазонам допустимых значений. Если в графике прокатки суммарная длина полос партий по каждому виду продукции находится в заданном диапазоне, то такой график прокатки будем называть сбалансированным по видам продукции, или просто сбалансированным.

Задача формирования сбалансированного графика прокатки является весьма нетривиальной, поскольку существует целый ряд технологических ограничений, которым график прокатки должен удовлетворять.

Основными технологическими ограничениями являются ограничения на допустимый порядок следования партий друг за другом в графике прокатки.
В данной работе рассмотрены два из них, оба ограничения возникают из-за конструктивных особенностей стана горячей прокатки.
Первое ограничение состоит в том, что требуется формировать только такие графики прокатки, в которых ширина каждой следующей партии не возрастает. Оно обусловлено тем, что во время прокатки рабочие валки стана сильно изнашиваются, и на их поверхности появляется углубление по ширине прокатываемых заготовок. Поэтому если после заготовки с меньшей шириной пропустить через стан заготовку с большей шириной, то на поверхности последней могут появиться дефекты.
Также к первому ограничению относится требование, чтобы ширина каждой следующей партии в графике прокатки не уменьшалась больше, чем на заданную величину.
Второе ограничение на порядок следования партий друг за другом в графике прокатки заключается в том, что толщина каждой следующей партии не должна слишком сильно отличаться от толщины предыдущей. Это ограничение обусловлено тем, что во время прокатки необходимо подстраивать расстояние между верхними и нижними валками стана в соответствии с толщиной прокатываемой заготовки, при этом хочется минимизировать эти перестроения валков.

Кроме того в данной работе рассматривается еще один класс ограничений связанных со временем готовности партий к прокатке.

Поскольку обычно производственный цикл металлургического предприятия является непрерывным, то при формировании каждого следующего графика прокатки помимо текущего множества готовых к прокатке партий, также известно, какие еще партии будут произведены и станут готовы  к прокате в ближайшем будущем. Эти еще не произведенные партии участвуют в формировании графиков прокатки наравне с уже готовыми партиями. Рассматривается ситуация, когда для каждой партии известен момент времени, начиная с которого партия готова к прокатке, а также известно какой промежуток времени требуется на прокатку данной партии. Эта информация позволяет формировать графики, в которых некоторые партии еще не готовы к прокатке на момент начала прокатки графика. При этом накладывается требование, чтобы к моменту, когда очередь дойдет до каждой следующей партии, она была готова к прокатке.
 
В настоящей работе будет предложена математическая модель для задачи формирования сбалансированного графика прокатки и алгоритм ее решения.

\newpage

\chapter{Формализация задачи построения сбалансированного графика прокатки}
\label{formulation}

Обозначим все множество партий через $P$. Рассматривается конечный набор партий, то есть $|P| \in \mathbb N$. 

\section{Ограничения на порядок следования партий}
Для начала формализуем ограничения на порядок следования партий друг за другом в графике прокатки.

Введем следующие обозначения. 

\begin{itemize}
\item $w: P \rightarrow \mathbb{R}^+$ — ширина полос, получаемых из слябов партии, значение $w$ на элементе $p \in P$ будем обозначать $w_p$.

    Множество всех ширин партий обозначим через $W = \{w_p | p \in P \}$.

\item $\delta \in \mathbb{R}^+$ --- максимальная величина допустимой разности значений ширины полос между любыми двумя соседними партиями.

\item $t: P \rightarrow \mathbb{R}^+$ — толщина полос, получаемых из слябов партии, значение $t$ на элементе $p \in P$ будем обозначать $t_p$.
    
\item $r: \mathbb{R}^+ \rightarrow \mathbb{R}^+$ --- функция, определяющая максимальную величину, на которую может отличаться значение толщины партии от значения толщины соседней партии в графике прокатки. Данная функция должна быть монотонно неубывающей, то есть 
    $\forall t_1, t_2 \in {\mathbb R}^+ \; t_1 \le t_2 \Rightarrow r(t_1) \le r(t_2)$.
\end{itemize}

Ограничение на предшествование партий определим следующим образом: партия $q$ может непосредственно следовать за партией $p$ в графике прокатки в том и только в том случае, когда выполнено
\begin{enumerate}
\item ограничение <<для перехода по толщине>>:
 $|t_p - t_q| \le \min\{r(t_p), r(t_q)\}$;
\item ограничение <<для перехода по ширине>>:
$0 \le w_p - w_q \le \delta$.
\end{enumerate}

Определенное таким образом ограничение представляет собой формализацию базовых условий предшествования партий, используемых на некоторых отечественных предприятиях. В частности, на магнитагорском металлургическом комбинате используется значения $\delta = 250 \; mm$. Далее  представлен пример функции $r$.
 \begin{equation*} r(t) = \begin{cases}
                0.8, & \text{если $t \in [1.29, 2]$;}\\
                1.5, & \text{если $t \in (2, 3]$;}\\
                2, & \text{если $t \in (3, 16]$};\\
                4, & \text{если $t \in (16, 20]$};\\
                \text{не определена}, & \text{если $t \in [0, 1.29) \cup (20, +\infty)$}.
         \end{cases} \end{equation*}

\textbf{Пример.} Пусть имеются две партии $p$ и $q$. 

Если $w_p$ = $w_q$, это означает, что для этих партий тривиально выполнено <<ограничение для перехода по ширине>>.

Если $t_p = 2, t_q = 3$, то для этих партий <<ограничение для перехода по толщине>> не выполнено.

Если $t_p = 2.5, t_q = 2$, то для этих партий <<ограничение для перехода по толщине>> выполнено.

\section{Сбалансированность графика прокатки}
Обозначим множество видов продукции партий через $F$. Различных видов продукции конченое число, то есть $|F| \in \mathbb{N}$.
Введем следующие обозначения.

\begin{itemize}
\item $f: P \rightarrow F$ — функция, сопоставляющая каждой партии соответствующий ей вид продукции.

\item $l: P \rightarrow \mathbb{R}^+$ — весовая функция, характеризующая полезность партии,\\ значение $l$ на элементе $p \in P$ будем обозначать $l(p)$.
    
    В зависимости от конкретной задачи, в качестве полезности партии могут выступать разные характеристики. Этими характеристиками могут быть длина (в километрах), вес (в тоннах) партии, а также более сложные величины, учитывающие спрос, время изготовления, стоимость продукции и так далее. 
    
    В данной работе $l(p)$ — суммарная длина полос партии $p$. Поскольку функция $l$ названа <<весовой>>, то далее будем говорить про вес партии, имея ввиду значение $l(p)$.


\item $\mu : F \rightarrow \mathbb{R^+}$ — функция, задающая целевые значения суммарного веса партий каждого вида продукции в графике прокатки.

\item $\Delta : F \rightarrow \mathbb{R^+}$ — функция, задающая абсолютную величину допустимого отклонения от целевого значения суммарного веса партий по каждому виду продукции в графике прокатки.

\item $L_{min}, L_{max} \in \mathbb{R^+}$ — числа, задающие диапазон допустимых значений суммарного веса партий в графике прокатки.



\end{itemize}

\section{Граф предшествования партий}
В настоящей работе предложен подход, при котором ограничения на порядок следования партий формализуются при помощи графа предшествования партий.
Пусть $G$ раскрашенный вершинно-взвешенный ориентированный граф со множеством узлов $P$ и с множеством дуг $E \subseteq P\times P$ таким, что $pq \in E$ в том и только в том случае, когда партии $p$ и $q$ различны, и $q$ может непосредственно следовать за $p$ в графике прокатки.
Весом каждого узла в $G$ положим вес соответствующей партии $l(p)$, цвет каждого узла в $G$ соответствует виду продукции, к которому относится соответствующая партия.

В прошлой работе (\cite{berezinant}) был придуман удобный способ укладки графа предшествования партий на координатной плоскости, при котором абсциссой каждого узла является значение функции $t$, а ординатой значение функции $w$. На рисунке \ref{precedence_graph} изображен фрагмент графа предшествования партий.
\begin{figure}[h!]
\centering
\includegraphics[width=300px]{img/colored_graph.png}
\caption{Граф предшествования партий}
\label{precedence_graph}
\end{figure}

На этом рисунке можно наглядно увидеть ограничение <<для перехода по ширине>>. Оно заключается в том, что все дуги в графе предшествования партий направлены либо сверху внизу, либо горизонтально, и в графе отсутствуют дуги идущие снизу вверх. Ограничение <<для перехода по толщине>> так же проиллюстрировано тем, что между собой соединены лишь те узлы, которые имеют достаточно близкие абсциссы.

Любой дуге в графе $G$ соответствует упорядоченная пара партий, которая является технологически пригодной для прокатки в таком порядке. Поэтому множеству всех простых цепей в $G$ соответствует множество всех допустимых графиков прокатки для рассматриваемого множества партий $P$. Множество всех простых цепей в $G$ обозначим через $\mathbb{B}(G)$.


\section{Задача существования сбалансированной простой цепи}

Пусть $P(M)$ — множество узлов произвольного подграфа $М$ графа $G$.

Для простой цепи $H \in \mathbb{B}(G)$ через $l(H)$ обозначим её вес.

$$l(H) \triangleq \displaystyle\sum_{p \in P(H)} l(p)$$

Пронумеруем виды продукции, пусть $F = \{f_1, f_2, \ldots, f_s\}$.

Сформулируем задачу поиска допустимого решения — найти в $\mathbb{B}(G)$ такую \\ цепь $H$, что выполнены ограничения:

\begin{equation}  L_{min} \le \displaystyle\sum_{p \in P(H)} l(p) \le L_{max} \end{equation}

\begin{equation}
\forall k \in \overline{1,s}\;\;\;\; \mu_k - \Delta_k \le \sum_{p \in P(H), f(p) = f_k} l(p) \le \mu_k + \Delta_k
\end{equation}

\section{Дополнительные обозначения}

Пусть $p$ — произвольный узел в $G$. Обозначим через:
\begin{itemize}
\item $In(p)$ --- множество узлов $q$ таких, что дуга $qp \in E$
\\ $|In(p)|$ --- входящая валентность узла $p$
\item $In^{+}(p) = \{q \in In(p) | w_q > w_p\}$
\item $Out(p)$ --- множество узлов $q$ таких, что дуга $pq \in E$
\\ $|Out(p)|$ --- исходящая валентность узла $p$
\item $Succ(p)$ --- множество всех узлов $q$, для которых существует ориентированный путь $pq$ в графе $G$. Из
общей теории графов известно, что в этом случае также существует и простая цепь из $p$ в $q$.
\item $Pred(p)$ --- множество всех узлов $q$, для которых существует ориентированный путь из $q$ в $p$ в графе $G$.
Отметим, что в этом случае также существует и простая цепь из $q$ в $p$.
\item $W = \{w_p| p \in P\}$ --- всевозможные значения ширин узлов
\item $P_w = \{p \in P | w_p = w\}$, где $w \in W$, --- множество узлов, имеющих данную ширину $w$.
\item $G_w$ --- граф, индуцированный множеством $P_w$.
\end{itemize}

\newpage

\chapter{Описание подхода и структура работы}
\label{method}

Решение задачи поиска <<сбалансированной>> простой цепи сводится к решению серии задач вещественно-целочисленного линейного программирования. Этот подход основан на результатах авторов по изучению структуры графа предшествования партий и позволяет существенно снизить размерность получаемых задач линейного программирования по сравнению с прямым использовании классических техник для их построения (например, \cite{Dantzig}).


Инструментом для решения практической задачи является задача существования сбалансированного графика прокатки. В предыдущей работе рассмотрена оптимизационная постановка задачи построения графика прокатки, в ней критерием оптимальности выбран суммарный вес/длина вошедших в график прокатки партий. Эту задачу удалось решить, предложив конструктивный алгоритм кубической сложности. Для решения задачи построения сбалансированного графика создание подобного алгоритма оказалось гораздо более сложным, поскольку помимо маршрутной составляющей задачи присутствуют ограничения на суммарный вес по каждому виду продукции и ограничение на время готовности партий к прокатке. поэтому решено было прибегнуть к аппарату математического программирования, поскольку это позволяет единообразно рассматривать как маршрутные, так и объемные ограничения. Для того, чтобы получающаяся в итоге задача решалась за разумное время было произведено исследование структуры графа следования партий. Это исследование позволило сформулировать маршрутные ограничения гораздо более <<экономно>> с точки зрения количества задействованных в них переменных и неравенств.

Целесообразно было начать решение задачи существования сбалансированного графика с рассмотрения некоторых приближенных и упрощенных вариантов. Впоследствии была решена и исходная задача. Однако приближенные варианты задачи тоже ценны, поскольку для их решения требуется существенно меньше времени и в некоторых ситуациях это может быть полезно. Кроме того, начиная изложение с приближенных задач, можно на более простых примерах продемонстрировать идеи, которые используются и для решения точной задачи.


Идея, на которой основывается создание приближенных задач заключается в том, что в качестве исходного набора узлов для поиска сбалансированной простой цепи можно рассматривать не все множество узлов графа, а только какую-то часть. При этом хочется, чтобы узлы из этого порождали <<хорошо связанный>> граф, в котором было бы достаточно дуг, чтобы сформировать простую цепь достаточного веса, а также хочется, чтобы в этом множестве было достаточно количество партий каждого вида, чтобы в сформированной простой цепи удалось соблюсти заданное распределение по видам продукции.

Структура ориентированного графа следования партий такова, что граф состоит из некоторого количества обыкновенных подграфов. Если узлы графа следования партий расположить на плоскости таким образом, чтобы координатами узла были его толщина и ширина, то эти обыкновенные подграфы будут состоять из узлов, имеющих одинаковую ординату (все узлы с одинаковым значением $w$). При этом в соответствии с ограничением 2 <<для перехода по ширине>> дуги между узлами различных подграфов могут идти только сверху вниз, и никогда не снизу вверх. Поэтому любая достаточно длинная простая цепь в большом графе следования партий будет проходить через узлы этих подграфов сверху вниз.


Решение задачи существования сбалансированного графика (простая цепь в $G$) проходит через последовательность подграфов $G_{w_i}$. В качестве приближения к решению этой задачи решаются локальные задачи существования, когда заранее выбирается последовательность подграфов $G_{w_i}$ через которые должно пройти решение.

Разработанный в прошлой работе алгоритм построения простой цепи максимального веса в графе следования партий просматривает эти подграфы в порядке <<сверху вниз>> и строит максимальную по весу цепь. Эта цепь отлично подходит в качестве некого начального приближения к решению задачи поиска сбалансированной простой цепи, поскольку обычно ее вес заведомо больше, чем требуется для сбалансированной цепи (а если он меньше, то значит, что поставленная задача поиска сбалансированной цепи заданного веса несовместна), и кроме того в ней обычно заведомо больше узлов относящихся к каждому виду продукции, чем того требует исходная задача.

Эвристическое соображение в том, что остается только удалить из этой цепи некоторые узлы, так чтобы суммарный вес цепи и соотношение по весу узлов разного вида продукции приблизились к искомым, и чтобы при этом не нарушилась связность этой цепи.

То есть план такой:
\begin{enumerate}
\item Генерируется некоторое начальное приближение. Для этого используется алгоритм построения простой цепи максимального веса (\cite{berezinant}) в графе $G$. Можно использовать и другие подходы.

\item Решается задача локальной оптимизации найденного приближения методами математического программирования.
\end{enumerate}

В качестве суженного множества для построения сбалансированной простой цепи выбирается множество узлов всех подграфов, через которые проходит цепь, являющаяся начальным приближением. При этом накладывается требование на то, чтобы узлы, через которые эти подграфы соединяются цепью-начальным приближением гарантированно входили в итоговую сбалансированную простую цепь. Этот ход позволяет очень сильно упросить маршрутную задачу, поскольку в итоговой цепи нет необходимости обеспечивать связность между узлами разных подграфов, нужно обеспечить только связность в рамках подграфов.

\subsection*{Приближенная задача 1}

Фиксируется последовательность подграфов $G_w$, а также пара узлов для каждого подграфа, которые обязательно должны войти в простую цепь, являющуюся решением задачи поиска сбалансированной простой цепи, и тем самым обеспечить связность частей цепи, относящихся к различным подграфам.

\begin{figure}[h!]
\centering
\includegraphics[width=300px]{img/first_model.png}
\caption{Связность подграфов $G_w$}
\label{first_model}
\end{figure}

Пусть заданы:

\begin{itemize}
    \item множество партий $P$,
    \item последовательность подграфов $G_{w_1}, G_{w_2}, \ldots, G_{w_m}$,
    \item пары вход-выход для каждого подграфа,
    \item ограничения предшествования в рамках подграфов,
    \item ограничения на суммарный вес и вес по каждому виду продукции.
\end{itemize}

Существует ли график прокатки при заданных ограничениях?

Фиксируется последовательность подграфов $G_w$, через которые в обязательном порядке должна пройти простая цепь, являющаяся решением.

Пусть заданы:

\begin{itemize}
    \item множество партий $P$,
    \item последовательность блоков $G_{w_1}, G_{w_2}, \ldots, G_{w_m}$,
    \item ограничения предшествования для связи соседних подграфов,
    \item ограничения предшествования в рамках подграфов,
    \item ограничения на суммарный вес и вес по каждому виду продукции.
\end{itemize}

Существует ли график прокатки при заданных ограничениях?

Фиксируется последовательность подграфов $G_w$, при этом простая цепь, являющаяся решением, может не содержать узлы из некоторых подграфов.

Пусть заданы:

\begin{itemize}
    \item множество партий $P$,
    \item последовательность блоков $G_{w_1}, G_{w_2}, \ldots, G_{w_m}$,
    \item ограничения предшествования для связи всех подграфов,
    \item ограничения предшествования в рамках подграфов,
    \item ограничения на суммарный вес и вес по каждому виду продукции.
\end{itemize}

Существует ли график прокатки при заданных ограничениях?

Частный случай задачи 3, когда в качестве последовательности выбираются все подграфы.

\chapter{Формальное описание алгоритма}
\label{algorytm}

$P$ — множество партий, $G_{w_1}, G_{w_2}, \ldots, G_{w_m}$ — набор подграфов графа следования партий, которые далее будем называть <<слоями>>.

Пронумеруем партии следующим образом :
$p_{ij}$ — $j$-я партия в $i$-м слое.

Каждой партии $p_{ij}$ соответствует переменная

 $b_{ij} = \begin{cases}
                1, & \text{если $p_{ij}$ вошла в график прокатки};\\
                0, & \text{если $p_{ij}$ не вошла в график прокатки}.
         \end{cases}$


Обозначим \begin{itemize}
\item $n_i = |P(G_{w_i})|$ — количество партий в слое $G_{w_i}$.
\item $l_{ij} = l(p_{ij})$ — вес $p_{ij}$ партии.
\item $L_{min}, L_{max}$ — заданные минимальное и максимальное значения суммарной длины партий в графике.
\item  $f_1, f_2, \ldots, f_s$ — набор видов продукции.
\item $\mu_i = \mu(f_i) = (\underline{\mu}_i, \overline{\mu}_i)$ — распределение видов продукции, заданное диапазоном суммарной длины партий, имеющих $f_i$ вид продукции.
\item  $f_{ij} = f(p_{ij})$ — вид продукции $p_{ij}$ партии.
\end{itemize}

\subsection*{Ограничение на суммарный вес}
\begin{equation}
L_{min} \le \displaystyle\sum_{i=1}^m \sum_{j=1}^{l_i} b_{ij}l_{ij}  \le L_{max}
\end{equation}

\subsection*{Ограничение на виды продукции}
\begin{equation}
\forall k \in \overline{1,s}\;\;\;\; \underline{\mu}_k \le \sum_{f_{ij} = f_k} b_{ij}l_{ij} \le \overline{\mu}_k
\end{equation}

Эти ограничения являются базовыми и далее меняться не будут. Подход к ограничениям предшествования может быть различным, и в зависимости от выбранного подхода можно получать более быстрые либо более качественные решения. Далее рассмотрим несколько подходов к формализации ограничений предшествования партий в графике прокатки.

\section{Первая модель}
\label{first_model}
В рамках этой модели рассматривается набор подграфов $G_{w_i}$, через которые проходит простая цепь, построенная на стадии генерации начального приближения. Фиксируются граничные узлы, через которые эти подграфы соединяются. Специальными ограничениями накладывается требование на то, чтобы эти узлы входили в построенное решение, таким образом удается избавиться от необходимости обеспечивать связность между соседними слоями в выбранном наборе подграфов. Необходимо лишь обеспечить связность решения в рамках отдельных подграфов.

\subsection*{Ограничение предшествования}

\begin{itemize}
\item $G_{w_i}$ — слой, $s_i$, $e_i$ — заданная пара узлов (вход и выход) для слоя $G_{w_i}$.
\item Пусть $p_{ij_0} \in G_{w_i}$, причем $p_{ij_0} \not = s_i$ и $p_{ij_0} \not = e_i$.
\end{itemize}
Пусть $p \in G_{w_i}$. Тогда $\forall q \in G_{w_i}: \; pq \in E$ обозначим
\begin{itemize}
\item $\overrightarrow{Out}_{G_{w_i}}(p)= \{q\;|\;t_q>t_p\},\;\overrightarrow{J_p} = \{j | p_{ij} \in \overrightarrow{Out}_{G_{w_i}}(p_{ij_0}) \}$.
\item $\overleftarrow{Out}_{G_{w_i}}(p)=\{q\;|\;t_q<t_p\}, \;\overleftarrow{J_p} = \{j | p_{ij} \in \overleftarrow{Out}_{G_{w_i}}(p_{ij_0}) \}$.
\end{itemize}

Тогда eсли $t(s_i) < t_{ij_0} < t(e_i)$, то

\begin{equation}
b_{ij_0}\le \displaystyle \sum_{j'  \in \overrightarrow{J_p}} b_{ij'} \;\;\;\;
b_{ij_0}\le \displaystyle \sum_{j'  \in \overleftarrow{J_p}} b_{ij'}
\end{equation}

Если $t_{ij_0} < t(s_i)$, то

\begin{equation}
2b_{ij_0}\le \displaystyle \sum_{j'  \in \overrightarrow{J_p}} b_{ij'}
\end{equation}

Если $t(e_i) < t_{ij_0}$, то

\begin{equation}
2b_{ij_0}\le \displaystyle \sum_{j'  \in \overleftarrow{J_p}} b_{ij'}
\end{equation}


\subsection*{Локальная задача существования}
Локальная задача существования состоит в том, чтобы найти решение следующей системы уравнений и неравенств, либо установить, что его не существует.

$\begin{cases}
                L_{min} \le \displaystyle\sum_{i=1}^m \sum_{j=1}^{n_i} b_{ij}l_{ij}  \le L_{max};\\

                \medskip

                \forall i \in \overline{1, m}: \; b_i^s=1, \; b_i^e=1;\\

                \medskip

                \forall i \in \overline{1, m} \; \forall j_0 \in \overline{1, n_i}(p_{ij_0}\not\in\{s_i,e_i\}): \\

                \medskip

                \; \begin{cases}
                 \;  b_{ij_0}\le \displaystyle \sum_{j'  \in \overrightarrow{J_p}} b_{ij'}, \;\;\; b_{ij_0}\le \displaystyle \sum_{j'  \in \overleftarrow{J_p}} b_{ij'} , & \text{ eсли $t(s_i) < t_{ij_0} < t(e_i)$};\\

                 \smallskip

                  \;   2b_{ij_0}\le \displaystyle \sum_{j'  \in \overrightarrow{J_p}} b_{ij'}, & \text{если $t_{ij_0} < t(s_i)$};\\

                 \smallskip

                   \;   2b_{ij_0}\le \displaystyle \sum_{j'  \in \overleftarrow{J_p}} b_{ij'}, & \text{если $t(e_i) < t_{ij_0}$}.
                \end{cases}\\

                \medskip

                \forall k\in \overline{1,s}\;\;\;\; \underline{\mu_k} \le \displaystyle \sum_{f_{ij} = f_k} b_{ij}l_{ij} \le \overline{\mu_k}.
\end{cases}$

Вложенная подсистема неравенств эквивалентна тому, что для партий, вошедших в решение, на подмножестве партий (узлов), принадлежащих одному блоку вместе с входом и выходом возможно построить путь в $G$ с началом во входном узле и окончанием в выходном узле. Возможность собрать все партии в решении локальной задачи в один путь тогда вытекает из того, что входы и выходы в следующих друг за другом блоках выбраны согласованно.

Локальная задача существования может быть использована для получения решений и в более компактной схеме. В предыдущей работе \cite{berezinant} предложен алгоритм кубической временной трудоемкости, решающий задачу поиска пути максимального веса. По такому пути естественным образом строится набор блоков с входами и выходами. Используя эти данные в качестве начальных в локальной задаче существования иногда возможно построить решение. Вычислительные эксперименты, проведенные с использование системы IBM ILOG CPLEX, показали, что зачастую таким коротким путём возможно получить решение локальной задачи существования и, соответственно, решение исходной задачи. При этом решение получается за короткое время при числе партий порядка 100. При этом оптимальное решение локальной задачи зачастую строится за 1-2 секунды.



\begin{lemma} В подграфе $G_w$ существует простая $(s, e)$-цепь тогда и только тогда, когда существует решение системы 6. \end{lemma}

\section{Вторая модель}
\subsection*{Расширенная локальная задача существования}

Пусть заданы : \begin{itemize}
\item множество партий $P$,
\item фиксированная последовательность подграфов  $G_{w_1}, G_{w_2}, \ldots, G_{w_m}$,
\item ограничения(на вес, на предшествование, на виды продукции).
\end{itemize}

В рамках этой модели так же рассматривается фиксированный набор подграфов $G_{w_i}$ полученный на стадии генерации начального приближения.
Отличие от предыдущей задачи в том, что теперь не зафиксировано то, какие узлы могут быть входами и выходами, а значит требуется ввести ограничения, описывающие связность между соседними уровнями.

К модели добавляются следующие переменные:

Каждой партии $p_{ij}$ соответствуют

 $s_{ij} = \begin{cases}
                1, & \text{если $p_{ij}$ является входом в $i$ слой};\\
                0, & \text{если $p_{ij}$ не является входом в $i$ слой}.
         \end{cases}$

 $e_{ij} = \begin{cases}
                1, & \text{если $p_{ij}$ является выходом из $i$ слоя};\\
                0, & \text{если $p_{ij}$ не является выходом из $i$ слоя}.
         \end{cases}$

А так же к существующим добавляются ограничения:

В каждом слое должен быть ровно один вход и ровно один выход
$$\forall i \; \displaystyle \sum_{j} s_{ij} = 1$$
$$\forall i \; \displaystyle \sum_{j} e_{ij} = 1$$

Входы и выходы должны быть включены в график прокатки
$$\forall i \; \forall j \; b_{ij} \ge s_{ij}$$
$$\forall i \; \forall j \; b_{ij} \ge e_{ij}$$

Определим множество узлов в $k$-том слое, которые были бы связаны с узлом, имеющим ширину $t$\\
$$O_k(t) = \{ v \in B_k | \; |t(v)-t| \le min\{r(t(v)),r(t)\}\}$$
И множество индексов этих узлов\\
$$J_k(t) = \{ j | \; p_{kj} \in O_k(t)\}$$

Смысл следующего ограничения в том, что для каждого входа в слой, среди узлов-предков этого входа должен существовать узел, являющийся
выходом
$$\forall i = 2,...,m \; \forall j_0 \; s_{ij_0} \le \displaystyle \sum_{j \in O_{i-1}(t_{ij})} e_{i-1j}$$
Соответствующее ограничение для выходов
$$\forall i = 1,...,m-1 \; \forall j_0 \; e_{ij_0} \le \displaystyle \sum_{j \in O_{i+1}(t_{ij})} s_{i+1j}$$

Ограничения предшествования в рамках отдельных подграфов заменяются двумя новыми ограничениями:


\begin{itemize}
\item $$b_{ij0} \le \frac{1}{2} \displaystyle \sum_{j' \in \overrightarrow{J_{(b_{ij_0})}^{o}}} b_{ij'} + (1 - \frac{1}{2} \displaystyle \sum_{j \in \overrightarrow{J_{(b_{ij_0})}}} (s_{ij} + e_{ij}))$$

\item $$b_{ij0} \le \frac{1}{2} \displaystyle \sum_{j' \in \overleftarrow{J_{(b_{ij_0})}^{o}}} b_{ij'} + (1 - \frac{1}{2} \displaystyle \sum_{j \in \overleftarrow{J_{(b_{ij_0})}}} (s_{ij} + e_{ij}))$$
\end{itemize}
Где

$$\overrightarrow{Out}_{B_i}^{o}(p)=\{q \in B_i\;|\;t_q>t_p, \;  \; |t_q-t_p| \le min\{r(t_q),r(t_p)\}\}$$
$$\overrightarrow{J_{p}^{o}} = \{j | p_{ij}\in \overrightarrow{Out}_{B_i}^{o}(p_{ij_0}) \}$$

и соответственно

$$\overleftarrow{Out}_{B_i}^{o}(p)=\{q \in B_i\;|\;t_q<t_p, \;  \; |t_q-t_p| \le min\{r(t_q),r(t_p)\}\}$$
$$\overleftarrow{J_{p}^{o}} = \{j | p_{ij}\in \overleftarrow{Out}_{B_i}^{o}(p_{ij_0}) \}$$


\section{Третья модель}

Эта модель является развитием предыдущей задачи. В предыдущей задаче была задана фиксированная последовательность подграфов, в том смысле что для построения решения необходимо было, чтобы в него были включены узлы из каждого подграфа. Теперь же сформулируем ограничения для связности подграфов таким образом, чтобы избежать этой необходимости. Это позволит рассматривать в рамках третьей модели произвольные последовательности подграфов (а значит, мы сможем перейти от локальных задач существования к глобальной).

Для каждого подграфа $G_{w_i}$ поставим в соответствие переменную $$q_i = \begin{cases}
                1, & \text{если подграф $G_{w_i}$ включен в решение (хотя бы 1 узел из $G_{w_i}$)};\\
                0, & \text{иначе}.
         \end{cases}$$

Если подграф $G_{w_i}$ не включен, то ни один его узел не представлен в решении.
$$\forall i \; \forall j \; b_{ij} \le q_i$$

Если хотя бы один узел подграфа $G_{w_i}$ включен, то подграф включен в решение.
$$\forall i \; q_i \le \displaystyle \sum_{j} b_{ij} $$

Если есть вход и есть выход, то подграф включен в решение.
$$\forall i \; q_i = \displaystyle \sum_{j} e_{ij} = \displaystyle \sum_{j} s_{ij}$$

Входы и выходы включены в решение.
$$\forall i \; \forall j \; b_{ij} \ge s_{ij}$$
$$\forall i \; \forall j \; b_{ij} \ge e_{ij}$$

Если подграф включен в решение, то среди узлов-предков входа в этот уровень должны быть включенные в решение узлы.
$$s_{ij} \le \displaystyle \sum_{k < l < i} q_l + \displaystyle \sum_{z \in In_{B_{k}}(p_{ij})}  e_{kz} + (1 - q_k)$$

Аналогично для выходов.
$$e_{ij} \le \displaystyle \sum_{i < l < k} q_l + \displaystyle \sum_{z \in Out_{B_{k}}(p_{ij})}  s_{kz} + (1 - q_k)$$

Плюс ограничения на связность в рамках подграфов не меняются, они такие же как и в предыдущей модели.

\begin{itemize}
\item $$b_{ij0} \le \frac{1}{2} \displaystyle \sum_{j' \in \overrightarrow{J_{(b_{ij_0})}^{o}}} b_{ij'} + (1 - \frac{1}{2} \displaystyle \sum_{j \in \overrightarrow{J_{(b_{ij_0})}}} (s_{ij} + e_{ij}))$$

\item $$b_{ij0} \le \frac{1}{2} \displaystyle \sum_{j' \in \overleftarrow{J_{(b_{ij_0})}^{o}}} b_{ij'} + (1 - \frac{1}{2} \displaystyle \sum_{j \in \overleftarrow{J_{(b_{ij_0})}}} (s_{ij} + e_{ij}))$$
\end{itemize}


\newpage

\chapter{Программная реализация}
\label{program}
В работе использован язык программирования Java.

\section{Описание кода программы}
\subsection{Типы данных}

\subsection{Методы}

\section{Результаты экспериментов}
Данные для тестов берутся из корпоративной сети ОАО "ММК". Обычно в распоряжении имеются выборки порядка 200-300 партий.

Реальные данные таковы, что обычно при больших выборках от 75\% процентов узлов попадают в построенную цепь. Это хороший с практической точки зрения результат, т.к. на производстве такие большие графики прокатки избыточны и построенную цепь можно дополнительно редактировать, добиваясь выполнения остальных технических ограничений, не упоминаемых в этой работе.


Так же отметим, что программа работает достаточно быстро, что важно, потому что в реальной жизни требуется многократный запуск алгоритма.
Видно, что скорость работы программы довольно сильно зависит от структуры конкретных начальных данных. Имеет значение соотношение между количеством подграфов в исходном графе и количеством входящих в них узлов. Например в случае, когда исходный граф состоит из малого числа подграфов, то время работы уменьшается за счет сокращения перебора дуг между подграфами(выборка 6).


(Тесты проводились на персональном компьютере).
\newpage


\section{Инструкция пользователю}
\label{instrution}

\newpage


\chapter*{Заключение}
\addcontentsline{toc}{chapter}{Заключение}
\label{conclusion}
Автоматическое планирование металлургического производства является сложной задачей, которая до сих пор не реализована полностью ни на одном предприятии в мире. Сопутствующие ей математические постановки зачастую являются труднорешаемыми. За счет исследования технологических ограничений на конкретном предприятии удалось сформулировать математическую задачу планирования графика прокатки. Удалось разработать полиномиальный алгоритм её решения. Результат уже частично внедрён и продолжается внедрятся на ОАО "ММК". В реальной жизни существуют более общие и сложные постановки задачи планирования графиков прокатки, решение которых основывается на описанных в настоящей работе алгоритмах.
\newpage

\small

\addcontentsline{toc}{chapter}{Список литературы}

\begin{thebibliography}{50}
\bibitem{svLeon_2016} {\it Леонова С.И.} {\rm Задача о формировании графика работы стана горячей прокатки, сбалансированного
по составу продукции, 2016}
\bibitem{svLeon_2014} {\it Леонова С.И.} {\rm Разработка и исследование алгоритмов построениея экстремальных цепей в вершинно-взвешенных ориентированных графах. Частный алгоритм, 2014}
\bibitem{berezinant} {\it Березин А.А.} {\rm Разработка и исследование алгоритмов построениея экстремальных цепей в вершинно-взвешенных ориентированных графах. Общий алгоритм, 2014}
\bibitem{Dantzig} {\it Dantzig G.B., Fulkerson D.R. , Johnson S.} {\rm On a linear programming combinatorial approach to the traveling salesman problem, Operations Research, 7 (1959), pp. 58–66}%
\bibitem{BeVaLe_Bals} {\it Balas E., Clarence H. M.}{\rm  Combinatorial optimization in steel rolling.
Workshop on Combinatorial Optimization in Science and Technology, April, 1991.}%
\bibitem{BeVaLe_ReviewStellProduction} {\it Lixin Tang, Jiyin Liu, Aiying Rong, Zihou Yang.} {\rm A review of planning and scheduling systems and methods for integrated steel production. European Journal of Operational Research. Volume 133, Issue 1, 16 August 2001, PP. 1–20.}%
\bibitem{BeVaLe_Liu} {\it Shixin Liu.} {\rm Model and Algorithm for Hot Rolling Batch Planning in Steel Plants. International Journal of Information and Management Sciences. 21 (2010), PP. 247-263.}%


\end{thebibliography}

\newpage

\chapter*{Приложение}
\addcontentsline{toc}{chapter}{Приложение}
\label{app}


\section*{Пример исходного кода}

\end{document} 